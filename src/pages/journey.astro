---
import type { CareerEntry } from '../components/CareerTimeline'
import CareerTimeline from '../components/CareerTimeline'
import resume from '../content/resume.json'
import BaseLayout from '../layouts/BaseLayout.astro'
import { formatDateRange } from '../lib/dates'
import '../styles/timeline.css'

const { basics, work, earlierCareer, innovation, skills, projects } = resume

// Build unified career timeline from resume data, newest first
// Split Flipside Crypto into three phases per actual career trajectory

const timelineEntries: CareerEntry[] = [
  // FSC Phase 3: IT & Security Leadership
  {
    company: 'Flipside Crypto',
    role: 'Head of IT & Security',
    period: '2025 – 2026',
    phase: 'IT & Security Leadership',
    description:
      'Full transition to IT and Security leadership while continuing to support data engineering teams. Directed enterprise security posture, compliance frameworks, and incident response.',
    highlights: [
      'Managed Fireblocks co-signer architecture in AWS secure enclaves; led migration to Fireblocks-native solution on GCP',
      'Directed Google Workspace, Cloudflare/Route53 DNS, compliance frameworks for insurance audits',
      'Continued supporting data platform teams throughout IT/Security transition',
    ],
  },
  // FSC Phase 2: AI Operations Pioneer
  {
    company: 'Flipside Crypto',
    role: 'Head of DevOps & AI Operations',
    period: '2023 – 2025',
    phase: 'AI Operations Pioneer',
    description:
      'Pioneered AI-driven IT operations 2+ years before agentic AI frameworks existed. Built and directed a fully autonomous AI engineering team.',
    highlights: [
      'Invented agentic orchestration patterns and human-in-the-loop review cycles before CrewAI, AutoGen, or LangGraph existed',
      'Drove AWS costs from ~$150K/month to ~$40-50K/month — over $100K/month in sustained savings',
      'Oversaw evolution to 99% serverless AWS (Lambda, managed services)',
    ],
    milestone: 'AI Operations Inventor',
  },
  // FSC Phase 1: Building DevOps Culture
  {
    company: 'Flipside Crypto',
    role: 'Head of DevOps',
    period: '2021 – 2023',
    phase: 'Building DevOps Culture',
    description:
      'First DevOps hire. Spent two years building DevOps as a culture. Identified the need for orthogonal SRE placements within product and data teams.',
    highlights: [
      'Built DevOps culture from the ground up at a blockchain analytics company',
      'Identified need for and placed orthogonal SRE engineers within product and data teams',
      'Built self-maintaining pipeline of Terraform/Terragrunt repository factories',
      'Mentored DC infrastructure SRE through multi-datacenter Kubernetes deployment',
    ],
  },
  // GoHealth
  {
    company: work[1].name,
    role: work[1].position,
    period: formatDateRange(work[1].startDate, work[1].endDate),
    description:
      'Spearheaded SRE initiatives for a high-traffic health insurance marketplace during peak enrollment periods.',
    highlights: work[1].highlights?.slice(0, 2),
  },
  // Symbiont
  {
    company: work[2].name,
    role: work[2].position,
    period: formatDateRange(work[2].startDate, work[2].endDate),
    description:
      'Owned enterprise CI/CD platform. Designed multi-cloud deployment architecture across AWS, GCP, and Azure for blockchain product engineering.',
    highlights: work[2].highlights?.slice(0, 2),
    milestone: 'Multi-Cloud IaC Pioneer',
  },
  // Jump Ramp
  {
    company: work[3].name,
    role: work[3].position,
    period: formatDateRange(work[3].startDate, work[3].endDate),
    description:
      'Modernized deployment with Docker containerization, restructured CI/CD, and overhauled network security with automated VPN bridging.',
  },
  // Qualia Media
  {
    company: work[4].name,
    role: work[4].position,
    period: formatDateRange(work[4].startDate, work[4].endDate),
    description:
      'Automated cloud infrastructure with Terraform and custom Ruby tooling. Built CI/CD systems and a metrics-based auto-scaler for Google Cloud.',
  },
  // ClassPass
  {
    company: work[5].name,
    role: work[5].position,
    period: formatDateRange(work[5].startDate, work[5].endDate),
    description:
      'Early Docker and Terraform champion — containerized production services and built IaC pipelines before mainstream adoption.',
    highlights: work[5].highlights?.slice(0, 2),
    milestone: 'Early Docker & Terraform Adopter',
  },
  // Magnetic
  {
    company: work[6].name,
    role: work[6].position,
    period: formatDateRange(work[6].startDate, work[6].endDate),
    description:
      'Managed 300+ machine infrastructure for a multinational ad-tech firm. Designed Chef cookbook overhauls and integrated Rundeck with PAM.',
  },
]

// Earlier career for foundation section
const foundationEntries = earlierCareer.positions.map((pos) => ({
  company: pos.name,
  role: pos.position,
  year: pos.year,
}))

// Skills for expandable sections
const cloudSkills = skills.find((s) => s.name === 'Cloud Platforms')
const iacSkills = skills.find((s) => s.name === 'Infrastructure as Code')
const containerSkills = skills.find((s) => s.name === 'Containers & Orchestration')
const aiSkills = skills.find((s) => s.name === 'AI & Automation')
const securitySkills = skills.find((s) => s.name === 'Security & Compliance')
---

<BaseLayout
  title="Journey"
  description="The career story of Jon Bogaty — 15+ years of DevOps, SRE, Security, and AI innovation across 13 companies."
>
  <!-- Compact Hero -->
  <section class="journey-hero">
    <div class="container">
      <div class="journey-hero-layout">
        <div class="journey-hero-text">
          <p class="overline">The Story So Far</p>
          <h1 class="journey-title">The Journey</h1>
          <p class="journey-subtitle">
            From freelance consulting in 2005 to pioneering AI-driven operations —
            a career built on being early to the technologies that matter.
          </p>
        </div>
        <div class="journey-hero-stats">
          <div class="jstat">
            <span class="jstat-value">2005</span>
            <span class="jstat-label">Career Start</span>
          </div>
          <div class="jstat">
            <span class="jstat-value">2015</span>
            <span class="jstat-label">Docker & Terraform</span>
          </div>
          <div class="jstat">
            <span class="jstat-value">2023</span>
            <span class="jstat-label">AI Operations</span>
          </div>
          <div class="jstat">
            <span class="jstat-value">13</span>
            <span class="jstat-label">Companies</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Horizontal Career Timeline (React Island) -->
  <section aria-labelledby="timeline-heading">
    <div class="container tl-section-header">
      <h2 id="timeline-heading" class="section-title">Career Timeline</h2>
      <p class="tl-hint">Scroll to explore &darr;</p>
    </div>
    <CareerTimeline entries={timelineEntries} client:visible />
  </section>

  <!-- Foundation Roles (compact grid) -->
  <section class="section-foundation" aria-labelledby="foundation-heading">
    <div class="container">
      <h2 id="foundation-heading" class="section-title">Foundation Roles <span class="title-dim">(2005–2014)</span></h2>
      <p class="foundation-intro">{earlierCareer.summary}</p>
      <div class="foundation-grid">
        {foundationEntries.map((pos) => (
          <div class="foundation-chip">
            <span class="foundation-company">{pos.company}</span>
            <span class="foundation-role">{pos.role}</span>
            <span class="foundation-year">{pos.year}</span>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Deep Dive Expertise -->
  <section class="section-expertise" aria-labelledby="expertise-heading">
    <div class="container">
      <h2 id="expertise-heading" class="section-title">Deep Dive</h2>
      <div class="expertise-grid">
        <details class="expandable">
          <summary class="expandable-trigger">Cloud Architecture & Infrastructure</summary>
          <div class="expandable-content">
            <p>Deep expertise across all major cloud platforms:</p>
            <div class="expertise-tags">
              {cloudSkills && cloudSkills.keywords.map((kw) => <span class="expertise-tag">{kw}</span>)}
              {iacSkills && iacSkills.keywords.map((kw) => <span class="expertise-tag">{kw}</span>)}
              {containerSkills && containerSkills.keywords.map((kw) => <span class="expertise-tag">{kw}</span>)}
            </div>
            <p>From 300+ machines at Magnetic to 99% serverless at Flipside Crypto — consistently pushing toward automated, resilient, cost-effective architectures.</p>
          </div>
        </details>

        <details class="expandable">
          <summary class="expandable-trigger">AI & Automation Innovation</summary>
          <div class="expandable-content">
            <p>Pioneered AI-driven IT operations at Flipside Crypto 2+ years before frameworks like CrewAI or LangGraph existed.</p>
            <div class="expertise-tags">
              {aiSkills && aiSkills.keywords.map((kw) => <span class="expertise-tag">{kw}</span>)}
              {securitySkills && securitySkills.keywords.slice(0, 4).map((kw) => <span class="expertise-tag">{kw}</span>)}
            </div>
            <p>Now publishing Agentic-Control, Agentic-Crew, and Agentic-Interfaces to the OSS community.</p>
          </div>
        </details>

        <details class="expandable">
          <summary class="expandable-trigger">Security & SRE Strategy</summary>
          <div class="expandable-content">
            <p>Full-spectrum security: zero-trust architecture, secrets management, incident response, compliance.</p>
            <div class="expertise-tags">
              {securitySkills && securitySkills.keywords.map((kw) => <span class="expertise-tag">{kw}</span>)}
            </div>
            <p>At GoHealth, drove SRE for high-traffic marketplace during peak enrollment. Consistent theme: reducing MTTR, improving uptime, building observability into every layer.</p>
          </div>
        </details>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="section-cta" aria-labelledby="cta-heading">
    <div class="container cta-container">
      <h2 id="cta-heading">Want the complete picture?</h2>
      <p class="cta-text">
        Explore the full resume with detailed highlights, or browse the open source ecosystem.
      </p>
      <div class="cta-actions">
        <a href="/resume/" class="btn btn-primary btn-lg">Full Resume</a>
        <a href="/projects/" class="btn btn-outlined btn-lg">Explore Projects</a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* ── Journey Hero ────────────────────────────────────────────────────── */
  .journey-hero {
    padding: var(--space-3xl) 0 var(--space-xl);
  }

  .journey-hero-layout {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-2xl);
    align-items: center;
  }

  .journey-title {
    font-family: var(--font-heading);
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 400;
    line-height: 1.1;
    margin-bottom: var(--space-md);
    background: linear-gradient(135deg, var(--brand), var(--brand-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .journey-subtitle {
    font-family: var(--font-body);
    font-size: clamp(0.9rem, 1.5vw, 1rem);
    color: var(--text-secondary);
    line-height: 1.7;
    max-width: 540px;
  }

  .journey-hero-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  .jstat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: var(--space-md) var(--space-lg);
    background: var(--bg-surface);
  }

  .jstat-value {
    font-family: var(--font-heading);
    font-size: 1.35rem;
    font-weight: 400;
    color: var(--text-primary);
  }

  .jstat-label {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    font-weight: 500;
    color: var(--text-disabled);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-align: center;
  }

  /* ── Timeline Section Header ─────────────────────────────────────────── */
  .tl-section-header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    padding-bottom: var(--space-md);
  }

  .tl-hint {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--text-disabled);
    animation: pulse-opacity 2s ease-in-out infinite;
  }

  @keyframes pulse-opacity {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }

  /* ── Section Titles ──────────────────────────────────────────────────── */
  .section-title {
    font-family: var(--font-heading);
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 400;
    color: var(--text-primary);
    margin-bottom: var(--space-lg);
  }

  .title-dim {
    color: var(--text-disabled);
    font-size: 0.6em;
  }

  /* ── Foundation Roles ─────────────────────────────────────────────────── */
  .section-foundation {
    padding: var(--space-3xl) 0;
    border-top: 1px solid var(--border);
  }

  .foundation-intro {
    font-family: var(--font-body);
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: var(--space-lg);
    max-width: 700px;
  }

  .foundation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--space-sm);
  }

  .foundation-chip {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: var(--space-sm) var(--space-md);
    display: flex;
    flex-direction: column;
    gap: 1px;
    transition: border-color 0.2s ease;
  }

  .foundation-chip:hover {
    border-color: var(--brand-dark);
  }

  .foundation-company {
    font-family: var(--font-body);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .foundation-role {
    font-family: var(--font-body);
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  .foundation-year {
    font-family: var(--font-mono);
    font-size: 0.68rem;
    color: var(--text-disabled);
  }

  /* ── Deep Dive Expertise ──────────────────────────────────────────────── */
  .section-expertise {
    padding: var(--space-3xl) 0;
    border-top: 1px solid var(--border);
  }

  .expertise-grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .expandable {
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: border-color 0.2s ease;
  }

  .expandable[open] {
    border-color: var(--brand-dark);
  }

  .expandable-trigger {
    cursor: pointer;
    padding: var(--space-md) var(--space-lg);
    font-family: var(--font-body);
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
    background: var(--bg-surface);
    list-style: none;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    transition: background 0.2s ease;
    user-select: none;
  }

  .expandable-trigger:hover {
    background: var(--bg-elevated);
  }

  .expandable-trigger::before {
    content: '';
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 6px solid var(--brand);
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    flex-shrink: 0;
    transition: transform 0.2s ease;
  }

  .expandable[open] > .expandable-trigger::before {
    transform: rotate(90deg);
  }

  .expandable-trigger::-webkit-details-marker {
    display: none;
  }

  .expandable-content {
    padding: var(--space-md) var(--space-lg) var(--space-lg);
    background: var(--bg-surface);
    border-top: 1px solid var(--border);
  }

  .expandable-content p {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: var(--space-md);
  }

  .expandable-content p:last-child {
    margin-bottom: 0;
  }

  .expertise-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
  }

  .expertise-tag {
    font-family: var(--font-body);
    font-size: 0.72rem;
    font-weight: 500;
    color: var(--brand);
    background: var(--brand-dim);
    border: 1px solid rgba(232, 168, 73, 0.25);
    border-radius: var(--radius-full);
    padding: 2px 10px;
    white-space: nowrap;
  }

  /* ── CTA Section ─────────────────────────────────────────────────────── */
  .section-cta {
    padding: var(--space-3xl) 0;
    border-top: 1px solid var(--border);
  }

  .cta-container {
    text-align: center;
  }

  .section-cta h2 {
    font-family: var(--font-heading);
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 400;
    color: var(--text-primary);
    margin-bottom: var(--space-md);
  }

  .cta-text {
    font-family: var(--font-body);
    font-size: 1rem;
    color: var(--text-secondary);
    line-height: 1.6;
    max-width: 480px;
    margin: 0 auto var(--space-xl);
  }

  .cta-actions {
    display: flex;
    justify-content: center;
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  /* ── Responsive ──────────────────────────────────────────────────────── */
  @media (max-width: 768px) {
    .journey-hero {
      padding: var(--space-2xl) 0 var(--space-lg);
    }

    .journey-hero-layout {
      grid-template-columns: 1fr;
      gap: var(--space-lg);
    }

    .journey-hero-stats {
      max-width: 320px;
    }

    .foundation-grid {
      grid-template-columns: 1fr 1fr;
    }

    .cta-actions {
      flex-direction: column;
      align-items: center;
    }

    .cta-actions .btn {
      width: 100%;
      max-width: 280px;
    }
  }

  @media (max-width: 480px) {
    .journey-title {
      font-size: 2.25rem;
    }

    .journey-hero-stats {
      max-width: 100%;
    }

    .jstat {
      padding: var(--space-sm) var(--space-md);
    }

    .jstat-value {
      font-size: 1.15rem;
    }

    .foundation-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
