---
import type { Category, Language } from '../data/ecosystem'
import {
  categories,
  getFeaturedPackages,
  getPackageCount,
  getPackagesByCategory,
  getPackagesByLanguage,
  languages,
} from '../data/ecosystem'
import BaseLayout from '../layouts/BaseLayout.astro'

const packageCount = getPackageCount()
const featured = getFeaturedPackages()

const languageStats = (Object.keys(languages) as Language[]).map((key) => ({
  key,
  ...languages[key],
  count: getPackagesByLanguage(key).length,
}))

const categoryList: { key: Category; icon: string }[] = [
  { key: 'ai', icon: 'AI' },
  { key: 'games', icon: 'GD' },
  { key: 'infra', icon: 'IF' },
  { key: 'libs', icon: 'LB' },
]
---

<BaseLayout
  title="jbcom - Open Source Ecosystem"
  description="Production-grade open source tools for AI agents, game development, infrastructure, and developer libraries."
>
  <!-- Hero -->
  <section class="hero" aria-labelledby="hero-heading">
    <p class="overline">Open Source Ecosystem</p>
    <h1 id="hero-heading" class="hero-heading">
      Production-grade tools<br />for serious builders
    </h1>
    <p class="hero-subtitle">
      {packageCount} packages spanning AI orchestration, procedural game engines,
      infrastructure automation, and developer libraries.
    </p>
    <div class="hero-actions">
      <a href="/ecosystem/" class="btn btn-primary">Explore Packages</a>
      <a
        href="https://github.com/jbcom"
        class="btn btn-secondary"
        target="_blank"
        rel="noopener noreferrer"
      >
        GitHub
      </a>
    </div>
  </section>

  <!-- Mission -->
  <section class="section" aria-labelledby="mission-heading">
    <div class="card mission-card">
      <h2 id="mission-heading" class="card-title">Mission</h2>
      <p class="card-description">
        Building composable, production-tested tools that solve real problems.
        Every package is designed to work standalone or snap together into larger systems.
      </p>
      <div class="principles">
        <div class="principle">
          <h3 class="principle-title">Production-First</h3>
          <p class="principle-text">
            Battle-tested in real workloads before release. No toy projects.
          </p>
        </div>
        <div class="principle">
          <h3 class="principle-title">Composable</h3>
          <p class="principle-text">
            Small, focused packages that combine into powerful systems.
          </p>
        </div>
        <div class="principle">
          <h3 class="principle-title">Well-Documented</h3>
          <p class="principle-text">
            Clear APIs, real examples, and maintained documentation.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Multi-Language Ecosystem -->
  <section class="section" aria-labelledby="languages-heading">
    <h2 id="languages-heading" class="section-heading">Multi-Language Ecosystem</h2>
    <div class="language-grid">
      {languageStats.map((lang) => (
        <div class="language-card" style={`--lang-color: ${lang.color}`}>
          <span class="language-icon">{lang.icon}</span>
          <span class="language-name">{lang.name}</span>
          <span class="language-count">{lang.count} packages</span>
        </div>
      ))}
    </div>
  </section>

  <!-- Categories -->
  <section class="section" aria-labelledby="categories-heading">
    <h2 id="categories-heading" class="section-heading">Categories</h2>
    <div class="category-grid">
      {categoryList.map(({ key }) => {
        const cat = categories[key];
        const count = getPackagesByCategory(key).length;
        return (
          <a href="/ecosystem/" class="category-card" style={`--cat-color: ${cat.color}`}>
            <h3 class="category-name">{cat.name}</h3>
            <p class="category-description">{cat.description}</p>
            <span class="category-count">{count} packages</span>
          </a>
        );
      })}
    </div>
  </section>

  <!-- Featured Packages -->
  <section class="section" aria-labelledby="featured-heading">
    <h2 id="featured-heading" class="section-heading">Featured Packages</h2>
    <div class="featured-grid">
      {featured.map((pkg) => {
        const lang = languages[pkg.language];
        return (
          <article class="card package-card">
            <div class="package-header">
              <span class="lang-chip" style={`--chip-color: ${lang.color}`}>
                {lang.icon}
              </span>
              <span class="package-status" data-status={pkg.status}>
                {pkg.status}
              </span>
            </div>
            <h3 class="package-name">{pkg.displayName}</h3>
            <p class="package-description">{pkg.description}</p>
            <a
              href={pkg.repo}
              class="package-link"
              target="_blank"
              rel="noopener noreferrer"
            >
              View on GitHub
            </a>
          </article>
        );
      })}
    </div>
  </section>
</BaseLayout>

<style>
  /* ── Hero ───────────────────────────────────────────────────────────── */
  .hero {
    text-align: center;
    padding: 4rem 0 3rem;
  }

  .overline {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin: 0 0 1rem;
  }

  .hero-heading {
    font-family: var(--font-heading);
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1.15;
    margin: 0 0 1.25rem;
    letter-spacing: -0.03em;
  }

  .hero-subtitle {
    font-family: var(--font-body);
    font-size: 1.1rem;
    color: var(--text-secondary);
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto 2rem;
  }

  .hero-actions {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-body);
    font-size: 0.95rem;
    font-weight: 600;
    padding: 0.75rem 1.75rem;
    border-radius: 8px;
    text-decoration: none;
    transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
  }

  .btn-primary {
    background: var(--primary);
    color: var(--bg-default);
  }

  .btn-primary:hover {
    background: color-mix(in srgb, var(--primary) 85%, white);
  }

  .btn-secondary {
    background: transparent;
    color: var(--text-primary);
    border: 1px solid var(--border);
  }

  .btn-secondary:hover {
    border-color: var(--primary);
    color: var(--primary);
  }

  /* ── Shared Section ─────────────────────────────────────────────────── */
  .section {
    margin-bottom: 3.5rem;
  }

  .section-heading {
    font-family: var(--font-heading);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 1.5rem;
    letter-spacing: -0.01em;
  }

  .card {
    background: var(--bg-paper);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .card-title {
    font-family: var(--font-heading);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 0.75rem;
  }

  .card-description {
    font-family: var(--font-body);
    font-size: 0.95rem;
    color: var(--text-secondary);
    line-height: 1.7;
    margin: 0 0 1.5rem;
  }

  /* ── Mission ────────────────────────────────────────────────────────── */
  .mission-card {
    max-width: 800px;
    margin: 0 auto;
  }

  .principles {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .principle {
    text-align: center;
  }

  .principle-title {
    font-family: var(--font-heading);
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--primary);
    margin: 0 0 0.4rem;
  }

  .principle-text {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 0;
  }

  /* ── Language Grid ──────────────────────────────────────────────────── */
  .language-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .language-card {
    background: var(--bg-paper);
    border: 1px solid var(--border);
    border-top: 3px solid var(--lang-color);
    border-radius: 12px;
    padding: 1.25rem;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.4rem;
  }

  .language-icon {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--bg-default);
    background: var(--lang-color);
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    margin-bottom: 0.25rem;
  }

  .language-name {
    font-family: var(--font-heading);
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .language-count {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--text-disabled);
  }

  /* ── Category Grid ──────────────────────────────────────────────────── */
  .category-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .category-card {
    background: var(--bg-paper);
    border: 1px solid var(--border);
    border-left: 4px solid var(--cat-color);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
    text-decoration: none;
    transition: border-color 0.2s ease, background 0.2s ease;
  }

  .category-card:hover {
    background: var(--bg-elevated);
    border-color: var(--cat-color);
  }

  .category-name {
    font-family: var(--font-heading);
    font-size: 1.05rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 0.4rem;
  }

  .category-description {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0 0 0.6rem;
  }

  .category-count {
    font-family: var(--font-mono);
    font-size: 0.78rem;
    color: var(--text-disabled);
  }

  /* ── Featured Packages ──────────────────────────────────────────────── */
  .featured-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .package-card {
    display: flex;
    flex-direction: column;
  }

  .package-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.75rem;
  }

  .lang-chip {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: 700;
    color: white;
    background: var(--chip-color);
    padding: 0.2rem 0.55rem;
    border-radius: 4px;
    letter-spacing: 0.02em;
  }

  .package-status {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    padding: 0.2rem 0.6rem;
    border-radius: 9999px;
  }

  .package-status[data-status="stable"] {
    color: var(--success);
    background: color-mix(in srgb, var(--success) 12%, transparent);
  }

  .package-status[data-status="beta"] {
    color: var(--warning);
    background: color-mix(in srgb, var(--warning) 12%, transparent);
  }

  .package-status[data-status="alpha"] {
    color: var(--secondary);
    background: color-mix(in srgb, var(--secondary) 12%, transparent);
  }

  .package-status[data-status="wip"] {
    color: var(--text-disabled);
    background: color-mix(in srgb, var(--text-disabled) 12%, transparent);
  }

  .package-name {
    font-family: var(--font-mono);
    font-size: 1.05rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 0.5rem;
  }

  .package-description {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 0 0 1rem;
    flex-grow: 1;
  }

  .package-link {
    font-family: var(--font-body);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--primary);
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .package-link:hover {
    color: color-mix(in srgb, var(--primary) 80%, white);
    text-decoration: underline;
  }

  /* ── Responsive ─────────────────────────────────────────────────────── */
  @media (max-width: 768px) {
    .hero {
      padding: 2.5rem 0 2rem;
    }

    .principles {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .language-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .category-grid {
      grid-template-columns: 1fr;
    }

    .featured-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .hero-subtitle {
      font-size: 0.95rem;
    }

    .hero-actions {
      flex-direction: column;
      align-items: center;
    }

    .btn {
      width: 100%;
      max-width: 280px;
    }
  }
</style>
